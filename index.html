<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Multi-Tab Researcher</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      /* Theme Variables */
      :root {
        --bg-color: #eef2f3;
        --card-bg: #ffffff;
        --text-main: #2c3e50;
        --text-secondary: #555;
        --input-border: #ddd;
        --input-bg: #ffffff;
        --radio-bg: #f8f9fa;
        --link-bg: #f8f9fa;
        --link-text: #34495e;
        --accent-color: #3498db;
        --accent-hover: #2980b9;
      }

      [data-theme="dark"] {
        --bg-color: #1a1a1a;
        --card-bg: #2d2d2d;
        --text-main: #ecf0f1;
        --text-secondary: #bdc3c7;
        --input-border: #444;
        --input-bg: #3d3d3d;
        --radio-bg: #3d3d3d;
        --link-bg: #3d3d3d;
        --link-text: #ecf0f1;
      }

      /* Reset & Base Styles */
      * {
        box-sizing: border-box;
        transition:
          background-color 0.3s,
          color 0.3s,
          border-color 0.3s;
      }
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background-color: var(--bg-color);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
      }

      .card {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 450px;
        position: relative;
        /* Memberikan padding atas ekstra agar tombol tidak menabrak tepi */
        padding-top: 50px;
      }

      /* Theme Toggle Button Updated */
      .theme-toggle {
        position: absolute;
        top: 15px;
        right: 20px;
        background: var(--radio-bg);
        border: 1px solid var(--input-border);
        color: var(--text-main);
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        padding: 6px 14px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.2s;
        z-index: 10;
      }
      .theme-toggle:hover {
        opacity: 0.8;
      }

      h2 {
        text-align: center;
        color: var(--text-main);
        /* Memberikan jarak yang cukup dari tombol di atasnya */
        margin-top: 20px;
        margin-bottom: 25px;
      }
      .input-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        font-size: 14px;
        color: var(--text-secondary);
      }
      input[type="text"] {
        width: 100%;
        padding: 14px;
        border: 2px solid var(--input-border);
        background-color: var(--input-bg);
        color: var(--text-main);
        border-radius: 8px;
        font-size: 16px;
      }
      input[type="text"]:focus {
        border-color: var(--accent-color);
        outline: none;
      }

      .input-group span:hover {
        text-decoration: underline;
        opacity: 0.8;
      }

      .checkbox-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        background: var(--radio-bg);
        padding: 12px;
        border: 1px solid var(--input-border);
        border-radius: 8px;
        max-height: 150px;
        overflow-y: auto;
        transition: border-color 0.3s;
      }
      .check-option {
        font-size: 13px;
        color: var(--text-main);
        display: flex;
        align-items: center;
        cursor: pointer;
      }
      .check-option input {
        margin-right: 8px;
      }

      .radio-group {
        display: flex;
        gap: 15px;
        margin-top: 5px;
        background: var(--radio-bg);
        padding: 10px;
        border-radius: 8px;
      }
      .radio-option {
        display: flex;
        align-items: center;
        font-size: 14px;
        cursor: pointer;
        font-weight: 500;
        color: var(--text-main);
      }
      .radio-option input {
        margin-right: 6px;
        cursor: pointer;
      }

      .btn-main {
        width: 100%;
        padding: 14px;
        background-color: var(--accent-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin-top: 15px;
      }
      .btn-main:hover {
        background-color: var(--accent-hover);
        transform: translateY(-1px);
      }
      #linkContainer {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--input-border);
        display: none;
      }
      .link-item {
        display: block;
        background: var(--link-bg);
        margin-bottom: 8px;
        padding: 10px;
        text-decoration: none;
        color: var(--link-text);
        border-radius: 6px;
        font-size: 14px;
        border-left: 4px solid var(--accent-color);
      }
      .link-item:hover {
        background: var(--accent-color);
        color: white;
      }
      .hint {
        font-size: 11px;
        color: #888;
        text-align: center;
        margin-top: 15px;
      }

      /* Memaksa teks SweetAlert Toast agar lebih tebal dan hitam */
      .swal2-toast .swal2-title {
        color: inherit !important;
        font-weight: 600 !important;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <button class="theme-toggle" id="themeToggle" title="Switch Theme">
        <span id="themeText">ðŸŒ™ Dark Mode</span>
      </button>
      <h2>Stock Multi-Tab Researcher</h2>

      <div class="input-group">
        <label>Exchange Code</label>
        <input type="text" id="exchange_code" placeholder="Example: SSE" />
      </div>

      <div class="input-group">
        <label>Ticker Symbol</label>
        <input type="text" id="ticker_symbol" placeholder="Example: 601398" />
      </div>

      <div class="input-group">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
          "
        >
          <label style="margin-bottom: 0">Select Data Points</label>
          <div
            style="
              font-size: 11px;
              cursor: pointer;
              color: var(--accent-color);
              font-weight: bold;
            "
          >
            <span onclick="toggleAllCheckboxes(true)">All</span> |
            <span onclick="toggleAllCheckboxes(false)">None</span>
          </div>
        </div>
        <div class="checkbox-grid" id="checkboxGrid">
          <label class="check-option"
            ><input type="checkbox" value="news" checked /> Latest News</label
          >
          <label class="check-option"
            ><input type="checkbox" value="stats" checked /> Ratios</label
          >
          <label class="check-option"
            ><input type="checkbox" value="overview" checked /> Overview</label
          >
          <label class="check-option"
            ><input type="checkbox" value="history" checked /> Historical
            Data</label
          >
          <label class="check-option"
            ><input type="checkbox" value="income" checked /> Income
            Statement</label
          >
          <label class="check-option"
            ><input type="checkbox" value="balance" checked /> Balance
            Sheet</label
          >
          <label class="check-option"
            ><input type="checkbox" value="cash" checked /> Cash Flow</label
          >
          <label class="check-option"
            ><input type="checkbox" value="revenue" checked /> Revenue</label
          >
          <label class="check-option"
            ><input type="checkbox" value="dividends" checked />
            Dividends</label
          >
        </div>
      </div>

      <div class="input-group">
        <label>Data Source Support</label>
        <div class="radio-group">
          <label class="radio-option">
            <input
              type="radio"
              name="source"
              value="stockanalysis"
              checked
            />Stock Analysis
          </label>
          <label class="radio-option">
            <input type="radio" name="source" value="tradingview" />TradingView
          </label>
        </div>
      </div>

      <button class="btn-main" onclick="processSearch()">Open All Tabs</button>

      <div id="linkContainer">
        <label>Manual Links:</label>
        <div id="linkList"></div>
      </div>

      <p id="hintText" class="hint" style="display: none">
        If tabs don't appear, please <b>Allow Pop-ups</b> in your settings.
      </p>
    </div>

    <script>
      const exchangeInput = document.getElementById("exchange_code");
      const tickerInput = document.getElementById("ticker_symbol");
      const radioButtons = document.querySelectorAll('input[name="source"]');
      const themeToggle = document.getElementById("themeToggle");
      const themeText = document.getElementById("themeText");

      // --- Theme Logic ---
      function setTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);
        themeText.innerText =
          theme === "dark" ? "â˜€ï¸ Light Mode" : "ðŸŒ™ Dark Mode";
      }

      themeToggle.addEventListener("click", () => {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        setTheme(currentTheme === "dark" ? "light" : "dark");
      });

      const savedTheme = localStorage.getItem("theme") || "light";
      setTheme(savedTheme);

      // --- Fungsi Kapitalisasi Otomatis (Hanya untuk nilai, bukan placeholder) ---
      function handleInputCase(e) {
        const source = document.querySelector(
          'input[name="source"]:checked',
        ).value;

        if (source === "stockanalysis") {
          // Paksa jadi huruf kecil untuk Stock Analysis
          e.target.value = e.target.value.toLowerCase();
        } else {
          // Paksa jadi HURUF BESAR untuk TradingView
          e.target.value = e.target.value.toUpperCase();
        }
      }

      // Tambahkan listener ke input
      exchangeInput.addEventListener("input", handleInputCase);
      tickerInput.addEventListener("input", handleInputCase);

      function updatePlaceholders() {
        const selectedSource = document.querySelector(
          'input[name="source"]:checked',
        ).value;

        if (selectedSource === "stockanalysis") {
          // LOGIKA BARU: Untuk Stock Analysis
          exchangeInput.placeholder = "Example: sha";
          tickerInput.placeholder = "Example: 601398";

          exchangeInput.style.textTransform = "none";
          tickerInput.style.textTransform = "none";

          // Ubah teks yang sudah ada menjadi KECIL
          exchangeInput.value = exchangeInput.value.toLowerCase();
          tickerInput.value = tickerInput.value.toLowerCase();
        } else {
          exchangeInput.placeholder = "Example: SSE";
          tickerInput.placeholder = "Example: 601398";

          exchangeInput.style.textTransform = "none";
          tickerInput.style.textTransform = "none";

          // Ubah teks yang sudah ada menjadi KAPITAL
          exchangeInput.value = exchangeInput.value.toUpperCase();
          tickerInput.value = tickerInput.value.toUpperCase();
        }
      }

      radioButtons.forEach((radio) => {
        radio.addEventListener("change", updatePlaceholders);
      });

      [tickerInput, exchangeInput].forEach((el) => {
        el.addEventListener("keypress", (e) => {
          if (e.key === "Enter") processSearch();
        });
      });

      function processSearch() {
        let exchange = exchangeInput.value.trim();
        let ticker = tickerInput.value.trim();
        const source = document.querySelector(
          'input[name="source"]:checked',
        ).value;
        const selectedData = Array.from(
          document.querySelectorAll("#checkboxGrid input:checked"),
        ).map((cb) => cb.value);

        // Deteksi Tema
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";

        // Konfigurasi SweetAlert2 Toast Mixin
        const Toast = Swal.mixin({
          toast: true,
          position: "top",
          showConfirmButton: false,
          timer: 5000,
          timerProgressBar: true,
          // Perbaikan warna latar dan teks
          background: isDark ? "#2d2d2d" : "#ffffff",
          color: isDark ? "#ffffff" : "#000000",
          // Hapus atau sesuaikan iconColor agar mengikuti warna default SweetAlert (Sukses = Hijau)
          iconColor: undefined,
          didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
          },
        });

        // Validasi Input Teks menggunakan Toast
        if (!exchange || !ticker) {
          Toast.fire({
            icon: "error",
            title: "Exchange & Ticker are required!",
          });
          return;
        }

        // Validasi Checkbox menggunakan Toast
        if (selectedData.length === 0) {
          Toast.fire({
            icon: "warning",
            title: "Select at least one data point!",
          });
          return;
        }

        // --- Logika Targets ---
        let allTargets = [];
        if (source === "stockanalysis") {
          exchange = exchange.toLowerCase();
          ticker = ticker.toLowerCase();
          allTargets = [
            {
              id: "news",
              name: "ðŸ“° Latest News",
              url: `https://www.google.com/search?q=${exchange}:%20${ticker}&tbm=nws&tbs=sbd:1`,
            },
            {
              id: "stats",
              name: "ðŸ“Š Financial Ratios",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/financials/ratios/?p=quarterly`,
            },
            {
              id: "overview",
              name: "ðŸ¢ Overview",
              // url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/company`,
              url: `https://translate.google.com/translate?sl=en&tl=id&u=https://www.stockanalysis.com/quote/${exchange}/${ticker}/company`,
            },
            {
              id: "history",
              name: "â³ Historical Data",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/history/`,
            },
            {
              id: "income",
              name: "ðŸ“‘ Income Statement",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/financials/?p=quarterly`,
            },
            {
              id: "balance",
              name: "âš–ï¸ Balance Sheet",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/financials/balance-sheet/?p=quarterly`,
            },
            {
              id: "cash",
              name: "ðŸ”„ Cash Flow",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/financials/cash-flow-statement/?p=quarterly`,
            },
            {
              id: "revenue",
              name: "ðŸ’° Revenue",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/financials/metrics/`,
            },
            {
              id: "dividends",
              name: "ðŸ’¸ Dividends",
              url: `https://www.stockanalysis.com/quote/${exchange}/${ticker}/dividend/`,
            },
          ];
        } else {
          exchange = exchange.toUpperCase();
          ticker = ticker.toUpperCase();
          allTargets = [
            {
              id: "news",
              name: "ðŸ“° Latest News",
              url: `https://www.google.com/search?q=${exchange}:%20${ticker}&tbm=nws&tbs=sbd:1`,
            },
            {
              id: "stats",
              name: "ðŸ“Š Financial Stats",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-statistics-and-ratios/`,
            },
            {
              id: "overview",
              name: "ðŸ¢ Overview",
              // url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/`,
              url: `https://translate.google.com/translate?sl=en&tl=id&u=https://www.tradingview.com/symbols/${exchange}-${ticker}/`,
            },
            {
              id: "history",
              name: "â³ Historical Data",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/?timeframe=120M`,
            },
            {
              id: "income",
              name: "ðŸ“‘ Income Statement",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-income-statement/`,
            },
            {
              id: "balance",
              name: "âš–ï¸ Balance Sheet",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-balance-sheet/`,
            },
            {
              id: "cash",
              name: "ðŸ”„ Cash Flow",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-cash-flow/`,
            },
            {
              id: "revenue",
              name: "ðŸ’° Revenue",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-revenue/`,
            },
            {
              id: "dividends",
              name: "ðŸ’¸ Dividends",
              url: `https://www.tradingview.com/symbols/${exchange}-${ticker}/financials-dividends/`,
            },
          ];
        }

        const targets = allTargets.filter((t) => selectedData.includes(t.id));

        // Toast Sukses
        Toast.fire({
          icon: "success",
          title: `Opening ${targets.length} tabs for ${ticker.toUpperCase()}`,
        });

        // Tampilkan Link Manual
        document.getElementById("hintText").style.display = "block";
        const container = document.getElementById("linkContainer");
        const list = document.getElementById("linkList");
        list.innerHTML = "";
        container.style.display = "block";

        targets.forEach((item, index) => {
          const a = document.createElement("a");
          a.href = item.url;
          a.target = "_blank";
          a.className = "link-item";
          a.innerText = item.name;
          list.appendChild(a);

          // Buka tab otomatis dengan jeda
          setTimeout(() => {
            window.open(item.url, "_blank");
          }, index * 250);
        });
      }

      function toggleAllCheckboxes(selectAll) {
        const checkboxes = document.querySelectorAll(
          '#checkboxGrid input[type="checkbox"]',
        );
        checkboxes.forEach((cb) => {
          cb.checked = selectAll;
        });
      }

      updatePlaceholders();
    </script>
  </body>
</html>
